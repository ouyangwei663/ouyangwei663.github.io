(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{770:function(t,s,a){"use strict";a.r(s);var n=a(52),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),a("h4",{attrs:{id:"学习一门框架-需要先了解这个框架的生命周期。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#学习一门框架-需要先了解这个框架的生命周期。"}},[t._v("#")]),t._v(" 学习一门框架，需要先了解这个框架的生命周期。")]),t._v(" "),a("h3",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[t._v("#")])]),t._v(" "),a("hr"),t._v(" "),a("h3",{attrs:{id:"话不多说-先上图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#话不多说-先上图"}},[t._v("#")]),t._v(" 话不多说，先上图")]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"xx",href:"https://gitee.com/ouwei663/pictruerecord/raw/master/images/1634196608(1).jpg"}},[a("img",{attrs:{src:"https://gitee.com/ouwei663/pictruerecord/raw/master/images/1634196608(1).jpg",alt:""}})])]),t._v(" "),a("h1",{attrs:{id:"正题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正题"}},[t._v("#")]),t._v(" 正题")]),t._v(" "),a("h3",{attrs:{id:"react16-废弃的生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react16-废弃的生命周期"}},[t._v("#")]),t._v(" react16 废弃的生命周期")]),t._v(" "),a("ul",[a("li",[a("s",[t._v("componentWillMount")])]),t._v(" "),a("li",[a("s",[t._v("componentWillReceiveProps")])]),t._v(" "),a("li",[a("s",[t._v("componentWillUpdate")])])]),t._v(" "),a("p",[a("strong",[t._v("注：虽然在新版中已经废弃，但是并没有完全删除（废弃了，但没有完全废弃），使用的话控制台会出现如下警告")])]),t._v(" "),a("p",[a("a",{attrs:{"data-fancybox":"",title:"",href:"https://gitee.com/ouwei663/pictruerecord/raw/master/images/componentWillMountWarn.jpg"}},[a("img",{attrs:{src:"https://gitee.com/ouwei663/pictruerecord/raw/master/images/componentWillMountWarn.jpg",alt:""}})])]),t._v(" "),a("h2",{attrs:{id:"一、挂载部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、挂载部分"}},[t._v("#")]),t._v(" 一、挂载部分")]),t._v(" "),a("font",{attrs:{size:"3"}},[t._v("\n 1、组件在挂载前会先调用他的构造函数 "),a("font",{attrs:{color:"#ff502c"}},[t._v(" constructor")]),t._v(" 这是唯一一个可以直接修改state的地方，其他地方修改需要调用this.setState()\n"),a("p",[a("strong",[t._v("注： 一般情况下，不需要写这个构造函数，只有在需要在构造函数里初始化某个值，或者需要绑定方法才需要调用。如果是子组件需要在构造函数最上面调用super(props)，不然会出现this.props未定义的bug")])]),t._v(" "),a("br"),t._v("\n 2、然后是"),a("font",{attrs:{color:"#ff502c"}},[t._v(" getDerivedStateFromProps")]),t._v("（极少使用）。\n"),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// static为必填")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDerivedStateFromProps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("官方的解释是：\ngetDerivedStateFromProps 会在调用 render 方法之前调用，并且在初始挂载及后续更新时都会被调用。它应返回一个对象来更新 state，如果返回 null 则不更新任何内容。")]),t._v(" "),a("p",[t._v("此方法适用于罕见的用例，即 state 的值在任何时候都取决于 props。例如，实现 Transition 组件可能很方便，该组件会比较当前组件与下一组件，以决定针对哪些组件进行转场动画。")]),t._v(" "),a("br"),t._v(" "),a("p",[t._v("3、组件挂载完成的时候触发的生命周期函数 "),a("font",{attrs:{color:"#ff502c"}},[t._v(" componentDidMount")]),t._v(" 。当render数据都解析渲染完毕之后触发这一函数，该函数仅在客户端生效且仅会生效一次，在这个时间节点可以取得DOM，另外在该阶段可以进行一些异步操作如接口请求")],1)],1),t._v(" "),a("h2",{attrs:{id:"二、数据更新部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、数据更新部分"}},[t._v("#")]),t._v(" 二、数据更新部分")]),t._v(" "),a("font",{attrs:{size:"3"}},[t._v("\n1、从流程图可知，先经过"),a("font",{attrs:{color:"#ff502c"}},[t._v(" getDerivedStateFromProps")]),t._v("。此处和挂载阶段是一样的。\n"),a("br"),t._v("\n2、然后是"),a("font",{attrs:{color:"#ff502c"}},[t._v("shouldComponentUpdate")]),t._v("，该函数只有在接收到新的props或者state的时候会调用，能接收到两个参数：新的props和state。返回一个布尔值。可以由用户自行选择是否需要渲染。\n")],1),t._v(" "),a("p",[a("strong",[t._v("举个栗子：")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("shouldComponentUpdate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("nextProps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("nextState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当修改的数据不符合业务所需数据的时候")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" nextState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'张三'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// react：什么人？ 陌生人：.... react:有内鬼，停止交易!拿下他")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当修改的数据符合业务所需数据的时候")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" nextState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'张三'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 张三:大哥，自己人自己人 . react:嗯...放行")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("font",{attrs:{size:"3"}},[t._v("\n若不写这个函数，则默认返回true\n")]),t._v(" "),a("font",{attrs:{size:"3"}},[t._v("\n3、render完成后是："),a("font",{attrs:{color:"#ff502c"}},[t._v(" getSnapshotBeforeUpdate")]),t._v("。getSnapshotBeforeUpdate在提交到真实dom节点之前调用。\n ")],1),t._v(" "),a("p",[a("strong",[t._v("注：此方法需要和componentDidUpdate一起使用，单独写getSnapshotBeforeUpdate控制台会出现报错。")])]),t._v(" "),a("p",[a("strong",[t._v("使用场景不多，主要用于做一些UI处理。官网的栗子如下：")])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ScrollingList")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("React"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Component")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("listRef "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" React"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSnapshotBeforeUpdate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("prevProps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prevState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 我们是否在 list 中添加新的 items ？")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 捕获滚动​​位置以便我们稍后调整滚动位置。")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prevProps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("listRef"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scrollHeight "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scrollTop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("componentDidUpdate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("prevProps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prevState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" snapshot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果我们 snapshot 有值，说明我们刚刚添加了新的 items，")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调整滚动位置使得这些新 items 不会将旧的 items 推出视图。")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//（这里的 snapshot 是 getSnapshotBeforeUpdate 的返回值）")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("snapshot "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("listRef"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scrollTop "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scrollHeight "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" snapshot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div ref"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("listRef"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* ...contents... */")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("font",{attrs:{size:"3"}},[t._v("\n4、DOM更新完成是："),a("font",{attrs:{color:"#ff502c"}},[t._v(" componentDidUpdate")]),t._v("\n该方法在getSnapshotBeforeUpdate方法之后被调用，有三个参数prevProps，prevState，snapshot，表示之前的props，之前的state，和snapshot。第三个参数是getSnapshotBeforeUpdate返回的\n"),a("br"),t._v("\n在这个函数里我们可以操作DOM，和发起服务器请求，还可以setState，但是注意一定要用if语句控制，否则会导致无限循环\n")],1),t._v(" "),a("h2",{attrs:{id:"三、卸载部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、卸载部分"}},[t._v("#")]),t._v(" 三、卸载部分")]),t._v(" "),a("font",{attrs:{size:"3"}},[t._v("\n噢。到这里说明这个组件已经要gg了。他已经完成了他的一生。"),a("br"),t._v("\n在这里会调用"),a("font",{attrs:{color:"#ff502c"}},[t._v(" componentWillUnmount")]),t._v("，在这里不需要去进行任何数据的修改、DOM的操作。因为组件实例卸载后，将不会挂载他。即使用户再次来到这个组件，也不再是他。在这里需要将一些定时器、订阅消息等等清除。\n")],1)],1)}),[],!1,null,null,null);s.default=e.exports}}]);